# Type Hardening Specification

> Eliminate `any` types and strengthen type safety across the frontend codebase.

## Problem Statement

Despite TypeScript strict mode being enabled, the codebase contains:
- **27 explicit `: any` annotations** in production and test code
- **70+ `as any` type assertions** (many in auto-generated files)
- **Duplicated form schemas** instead of reusing generated API types
- **Weak error handling types** using `catch (err: any)`

## Current State

### âœ… What's Working
- **OpenAPI â†’ TypeScript pipeline**: `pnpm generate:types` creates `api-types.d.ts` and `api-schemas.ts`
- **Strict mode enabled** in `tsconfig.app.json`
- **Zod schemas generated** via `openapi-zod-client`

### ðŸ”´ Issues to Fix

#### 1. Explicit `any` Types in Production Code
| File | Line | Issue |
|------|------|-------|
| `hooks/api/useNotifications.ts` | 11 | `data_json?: any` |
| `hooks/api/useStaff.ts` | 27 | `response.data.map((m: any)` |
| `hooks/api/useProxy.ts` | 22 | `catch (error: any)` |
| `hooks/api/useCurrentUser.ts` | 13 | `retry: (failureCount, error: any)` |
| `components/tasks/TaskBoard.tsx` | 66 | `onSubmit = (data: any)` |
| `components/calls/CallCenterDashboard.tsx` | 76 | `onSubmit = (data: any)` |
| `components/staff/StaffForm.tsx` | 102 | `catch (err: any)` |
| `components/providers/ProviderForm.tsx` | 133 | `catch (err: any)` |
| `components/care-team/CareTeamAssignModal.tsx` | 73 | `catch (err: any)` |

#### 2. Explicit `any` Types in Test Code
| File | Issue |
|------|-------|
| `CareTeamList.test.tsx` | Mock component props typed as `any` |
| `InviteModal.test.tsx` | Mock component props typed as `any` |
| `settings.test.tsx` | Mock component props typed as `any` |
| `NotificationBell.test.tsx` | Hook mocks use `as any` |
| `MemberTable.test.tsx` | Hook mocks use `as any` |
| `OrgSwitcher.test.tsx` | Hook mocks use `as any` |
| `CallCenterDashboard.test.tsx` | Hook mocks use `as any` |

#### 3. Auto-Generated Files (Lower Priority)
- `routeTree.gen.ts`: Contains `as any` casts (TanStack Router generated)
- These are acceptable as they're auto-generated

#### 4. Form Schemas Not Using Generated Types
Forms define their own Zod schemas instead of importing from `api-schemas.ts`:
- `ProviderForm.tsx` â†’ should use `ProviderCreate`
- `StaffForm.tsx` â†’ should use `StaffCreate`
- `CareTeamAssignModal.tsx` â†’ should use `CareTeamAssignmentCreate`

## Out of Scope
- `routeTree.gen.ts` â€” auto-generated by TanStack Router
- Third-party library type issues

## Success Criteria
1. `grep -r ": any" src/` returns zero matches (excluding tests and generated files)
2. All form types derived from `api-schemas.ts` or `api-types.d.ts`
3. Typed error handling using `AxiosError` patterns
4. CI check validates no new `any` types introduced
